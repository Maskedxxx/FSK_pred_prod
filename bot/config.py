"""–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram –±–æ—Ç–∞.

–ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç python-dotenv –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ .env —Ñ–∞–π–ª–∞.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
    BOT_TOKEN: –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –æ—Ç @BotFather
"""

from __future__ import annotations

import os
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –≤ PYTHONPATH –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
PROJECT_ROOT = Path(__file__).parent.parent.resolve()
if str(PROJECT_ROOT) not in sys.path:
    sys.path.insert(0, str(PROJECT_ROOT))

from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º .env –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
load_dotenv(PROJECT_ROOT / ".env")


# =============================================================================
# Telegram Bot
# =============================================================================

BOT_TOKEN: str | None = os.getenv("BOT_TOKEN")

if not BOT_TOKEN:
    raise RuntimeError(
        "BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. "
        "–°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π BOT_TOKEN=<–≤–∞—à_—Ç–æ–∫–µ–Ω>"
    )


# =============================================================================
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞ –¥–ª—è –±–æ—Ç–∞
# =============================================================================

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ retry –¥–ª—è VLM —à–∞–≥–∞ –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
VLM_MAX_RETRIES: int = 2

# –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –º–µ–∂–¥—É retry (—Å–µ–∫—É–Ω–¥—ã)
VLM_RETRY_DELAY: float = 5.0


# =============================================================================
# –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞
# =============================================================================


class Messages:
    """–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ç–µ–∫—Å—Ç–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞."""

    WELCOME = (
        "üëã *–ü—Ä–∏–≤–µ—Ç!*\n\n"
        "–Ø –±–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –¥–µ—Ñ–µ–∫—Ç—ã.\n\n"
        "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É *¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç¬ª* —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å."
    )

    UPLOAD_INSTRUCTION = (
        "üìÑ *–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ PDF –∏–∑ Google Drive*\n\n"
        "–ü–∞–π–ø–ª–∞–π–Ω –≤–∫–ª—é—á–∞–µ—Ç 7 —à–∞–≥–æ–≤:\n"
        "1Ô∏è‚É£ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF\n"
        "2Ô∏è‚É£ OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ (~3-5 –º–∏–Ω)\n"
        "3Ô∏è‚É£ –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (~30 —Å–µ–∫)\n"
        "4Ô∏è‚É£ –û—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ Vision LLM (~1-2 –º–∏–Ω)\n"
        "5Ô∏è‚É£ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤ (~1 –º–∏–Ω)\n"
        "6Ô∏è‚É£ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è\n"
        "7Ô∏è‚É£ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel –æ—Ç—á—ë—Ç–∞\n\n"
        "–ü—Ä–æ—Å—Ç–æ –ø—Ä–∏—à–ª–∏—Ç–µ —Å—Å—ã–ª–∫—É, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã."
    )

    INVALID_LINK = (
        "‚ùå *–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å—Å—ã–ª–∫—É Google Drive*\n\n"
        "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Å—Å—ã–ª–∫—É –≤–∏–¥–∞:\n"
        "`https://drive.google.com/file/d/<ID>/view`"
    )

    LINK_ACCEPTED = "‚úÖ *–ü—Ä–∏–Ω—è–ª —Å—Å—ã–ª–∫—É* ‚Äî –Ω–∞—á–∏–Ω–∞—é –∑–∞–≥—Ä—É–∑–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞..."

    FALLBACK = (
        "ü§ñ *–ë–æ—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ*\n\n"
        "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ PDF –∏–∑ Google Drive –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–µ—Ñ–µ–∫—Ç–æ–≤, "
        "–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É *¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç¬ª* –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π."
    )

    # –®–∞–±–ª–æ–Ω—ã –¥–ª—è —à–∞–≥–æ–≤ –ø–∞–π–ø–ª–∞–π–Ω–∞
    STEP_DOWNLOAD_START = "‚¨áÔ∏è *–°–∫–∞—á–∏–≤–∞—é –¥–æ–∫—É–º–µ–Ω—Ç...*"
    STEP_DOWNLOAD_DONE = (
        "‚úÖ *–î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω*\n"
        "üìÅ –§–∞–π–ª: `{filename}`\n"
        "üìä –†–∞–∑–º–µ—Ä: {size}\n"
        "üóÇ –°–µ—Å—Å–∏—è: `{session}`"
    )

    STEP_OCR_START = "üîç *–®–∞–≥ 1/7: OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ*\n–≠—Ç–æ –∑–∞–π–º—ë—Ç 3-5 –º–∏–Ω—É—Ç..."
    STEP_OCR_DONE = (
        "‚úÖ *–®–∞–≥ 1/7 –∑–∞–≤–µ—Ä—à—ë–Ω*\n"
        "üìÑ –°—Ç—Ä–∞–Ω–∏—Ü: {pages}\n"
        "‚è± –í—Ä–µ–º—è: {duration:.1f} —Å–µ–∫"
    )

    STEP_FILTER_START = "üéØ *–®–∞–≥ 2/7: –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü*\n~30 —Å–µ–∫—É–Ω–¥..."
    STEP_FILTER_DONE = (
        "‚úÖ *–®–∞–≥ 2/7 –∑–∞–≤–µ—Ä—à—ë–Ω*\n"
        "üìë –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö: {relevant}/{total}\n"
        "üìç –î–∏–∞–ø–∞–∑–æ–Ω: —Å—Ç—Ä. {start}-{end}\n"
        "‚è± –í—Ä–µ–º—è: {duration:.1f} —Å–µ–∫"
    )
    STEP_FILTER_NO_PAGES = (
        "‚ö†Ô∏è *–†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã*\n\n"
        "–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–ª —Å—Ç—Ä–∞–Ω–∏—Ü —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –¥–µ—Ñ–µ–∫—Ç–æ–≤. "
        "–ü–∞–π–ø–ª–∞–π–Ω –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
    )

    STEP_VLM_START = "üß† *–®–∞–≥ 3/7: –û—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ Vision LLM*\n~1-2 –º–∏–Ω—É—Ç—ã..."
    STEP_VLM_RETRY = "‚ö†Ô∏è –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞, –ø–æ–≤—Ç–æ—Ä—è—é –ø–æ–ø—ã—Ç–∫—É {attempt}/{max_attempts}..."
    STEP_VLM_DONE = (
        "‚úÖ *–®–∞–≥ 3/7 –∑–∞–≤–µ—Ä—à—ë–Ω*\n"
        "üìÑ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü: {pages}\n"
        "‚è± –í—Ä–µ–º—è: {duration:.1f} —Å–µ–∫"
    )

    STEP_EXTRACT_START = "üìã *–®–∞–≥ 4/7: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤*\n~1 –º–∏–Ω—É—Ç–∞..."
    STEP_EXTRACT_DONE = (
        "‚úÖ *–®–∞–≥ 4/7 –∑–∞–≤–µ—Ä—à—ë–Ω*\n"
        "üîß –ù–∞–π–¥–µ–Ω–æ –¥–µ—Ñ–µ–∫—Ç–æ–≤: {defects}\n"
        "‚è± –í—Ä–µ–º—è: {duration:.1f} —Å–µ–∫"
    )

    STEP_DEDUP_START = "üîÑ *–®–∞–≥ 5/7: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è*"
    STEP_DEDUP_DONE = (
        "‚úÖ *–®–∞–≥ 5/7 –∑–∞–≤–µ—Ä—à—ë–Ω*\n"
        "üìä –í—Å–µ–≥–æ: {total}, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {unique}\n"
        "üîÅ –ì—Ä—É–ø–ø –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: {groups}\n"
        "‚è± –í—Ä–µ–º—è: {duration:.1f} —Å–µ–∫"
    )

    STEP_EXCEL_START = "üìä *–®–∞–≥ 6/7: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel*"
    STEP_EXCEL_DONE = "‚úÖ *–®–∞–≥ 6/7 –∑–∞–≤–µ—Ä—à—ë–Ω*\n‚è± –í—Ä–µ–º—è: {duration:.1f} —Å–µ–∫"

    STEP_SEND_START = "üì§ *–®–∞–≥ 7/7: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞*"

    PIPELINE_DONE = (
        "üéâ *–ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–Å–ù!*\n\n"
        "üìÅ –î–æ–∫—É–º–µ–Ω—Ç: `{filename}`\n"
        "üìÑ –°—Ç—Ä–∞–Ω–∏—Ü OCR: {ocr_pages}\n"
        "üìë –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö: {relevant_pages}\n"
        "üîß –î–µ—Ñ–µ–∫—Ç–æ–≤: {defects} (—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {unique})\n"
        "‚è± –û–±—â–µ–µ –≤—Ä–µ–º—è: {duration:.1f} —Å–µ–∫\n"
        "üóÇ –°–µ—Å—Å–∏—è: `{session}`"
    )

    ERROR_PIPELINE = "‚ùå *–û—à–∏–±–∫–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞:* {error}"
    ERROR_UNEXPECTED = (
        "‚ùå *–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞*\n\n"
        "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
    )
    ERROR_VLM_FAILED = (
        "‚ùå *–û—à–∏–±–∫–∞ —à–∞–≥–∞ VLM*\n\n"
        "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã —á–µ—Ä–µ–∑ Vision LLM.\n"
        "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
    )
